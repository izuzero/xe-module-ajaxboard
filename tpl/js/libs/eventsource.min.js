!function(t){"use strict";function e(){this.data={}}function n(){this.listeners=new e}function i(t){setTimeout(function(){throw t},0)}function o(t){this.type=t,this.target=null}function r(t,e){o.call(this,t),this.data=e.data,this.lastEventId=e.lastEventId}function s(t,e){var n=Number(t)||e;return I>n?I:n>N?N:n}function a(t,e,n){try{"function"==typeof e&&e.call(t,n)}catch(o){i(o)}}function u(e,i){function u(){M=y,null!==B&&(B.abort(),B=null),0!==H&&(clearTimeout(H),H=0),0!==D&&(clearTimeout(D),D=0),L.readyState=y}function l(t){var e=M===m||M===g?B.responseText||"":"",n=null,i=!1;if(M===g){var u=0,l="",c="";if(f)try{u=Number(B.status||0),l=String(B.statusText||""),c=String(B.getResponseHeader("Content-Type")||"")}catch(h){u=0}else u=200,c=B.contentType;if(200===u&&C.test(c)){if(M=m,q=!0,O=x,L.readyState=m,n=new o("open"),L.dispatchEvent(n),a(L,L.onopen,n),M===y)return}else if(0!==u){var d="";d=200!==u?"EventSource's response has a status "+u+" "+l.replace(/\s+/g," ")+" that is not 200. Aborting the connection.":"EventSource's response has a Content-Type specifying an unsupported type: "+c.replace(/\s+/g," ")+". Aborting the connection.",setTimeout(function(){throw new Error(d)}),i=!0}}if(M===m){e.length>G&&(q=!0);for(var p=G-1,I=e.length,D="\n";++p<I;)if(D=e[p],$===T&&"\n"===D)$=E;else if($===T&&($=E),"\r"===D||"\n"===D){if("data"===k?X.push(z):"id"===k?j=z:"event"===k?P=z:"retry"===k?(x=s(z,x),O=x):"heartbeatTimeout"===k&&(R=s(z,R),0!==H&&(clearTimeout(H),H=setTimeout(U,R))),z="",k="",$===E){if(0!==X.length&&(A=j,""===P&&(P="message"),n=new r(P,{data:X.join("\n"),lastEventId:j}),L.dispatchEvent(n),"message"===P&&a(L,L.onmessage,n),M===y))return;X.length=0,P=""}$="\r"===D?T:E}else $===E&&($=S),$===S?":"===D?$=w:k+=D:$===w?(" "!==D&&(z+=D),$=b):$===b&&(z+=D);G=I}M!==m&&M!==g||!(t||i||G>1048576||0===H&&!q)?0===H&&(q=!1,H=setTimeout(U,R)):(M=v,B.abort(),0!==H&&(clearTimeout(H),H=0),O>16*x&&(O=16*x),O>N&&(O=N),H=setTimeout(U,O),O=2*O+1,L.readyState=g,n=new o("error"),L.dispatchEvent(n),a(L,L.onerror,n))}function c(){l(!1)}function h(){l(!0)}e=String(e);var I=Boolean(d&&i&&i.withCredentials),x=s(i?i.retry:0/0,1e3),R=s(i?i.heartbeatTimeout:0/0,45e3),A=i&&i.lastEventId&&String(i.lastEventId)||"",L=this,O=x,q=!1,B=new p,H=0,D=0,G=0,M=v,X=[],j="",P="",U=null,$=E,k="",z="";i=null,f&&(D=setTimeout(function F(){3===B.readyState&&c(),D=setTimeout(F,500)},0)),U=function(){if(H=0,M!==v)return void l(!1);if(f&&(void 0!==B.sendAsBinary||void 0===B.onloadend)&&t.document&&t.document.readyState&&"complete"!==t.document.readyState)return void(H=setTimeout(U,4));B.onload=B.onerror=h,f&&(B.onabort=h,B.onreadystatechange=c),B.onprogress=c,q=!1,H=setTimeout(U,R),G=0,M=g,X.length=0,P="",j=A,z="",k="",$=E;var n=e.slice(0,5);n="data:"!==n&&"blob:"!==n?e+((-1===e.indexOf("?",0)?"?":"&")+"lastEventId="+encodeURIComponent(A)+"&r="+String(Math.random()+1).slice(2)):e,B.open("GET",n,!0),f&&(B.withCredentials=I,B.responseType="text",B.setRequestHeader("Accept","text/event-stream")),B.send(null)},n.call(this),this.close=u,this.url=e,this.readyState=g,this.withCredentials=I,this.onopen=null,this.onmessage=null,this.onerror=null,U()}function l(){this.CONNECTING=g,this.OPEN=m,this.CLOSED=y}e.prototype={get:function(t){return this.data[t+"~"]},set:function(t,e){this.data[t+"~"]=e},"delete":function(t){delete this.data[t+"~"]}},n.prototype={dispatchEvent:function(t){t.target=this;var e=String(t.type),n=this.listeners,o=n.get(e);if(o)for(var r=o.length,s=-1,a=null;++s<r;){a=o[s];try{a.call(this,t)}catch(u){i(u)}}},addEventListener:function(t,e){t=String(t);var n=this.listeners,i=n.get(t);i||(i=[],n.set(t,i));for(var o=i.length;--o>=0;)if(i[o]===e)return;i.push(e)},removeEventListener:function(t,e){t=String(t);var n=this.listeners,i=n.get(t);if(i){for(var o=i.length,r=[],s=-1;++s<o;)i[s]!==e&&r.push(i[s]);0===r.length?n["delete"](t):n.set(t,r)}}},r.prototype=o.prototype;var c=t.XMLHttpRequest,h=t.XDomainRequest,d=Boolean(c&&void 0!==(new c).withCredentials),f=d,p=d?c:h,v=-1,g=0,m=1,y=2,T=3,E=4,S=5,w=6,b=7,C=/^text\/event\-stream;?(\s*charset\=utf\-8)?$/i,I=1e3,N=18e6;l.prototype=n.prototype,u.prototype=new l,l.call(u),p&&(t.NativeEventSource=t.EventSource,t.EventSource=u)}(this);
